<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SC Court Scraper Dashboard</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind for Inter font and custom colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#4F46E5', // Indigo 600
                        'secondary': '#818CF8', // Indigo 400
                        'accent': '#EC4899', // Pink 500
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom styles for better scroll and subtle effects */
        body {
            background-color: #f8f8fc;
            min-height: 100vh;
        }
        .container-card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .loading-dot {
            animation: dot-fading 1.4s infinite ease-in-out both;
        }
        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes dot-fading {
            0%, 80%, 100% { opacity: 0; }
            40% { opacity: 1; }
        }
    </style>
</head>
<body class="font-sans antialiased p-4 sm:p-8">

    <div id="app" class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-primary tracking-tight mb-2">
                SC Court Search
            </h1>
            <p class="text-lg text-gray-500">
                Simultaneously scrape four SC counties for case records.
            </p>
        </header>

        <!-- Search Input Card -->
        <div class="bg-white p-6 rounded-xl container-card mb-8">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Search by Name</h2>
            
            <div class="flex flex-col sm:flex-row gap-4">
                <input type="text" id="nameInput" placeholder="Enter Full Name (e.g., John Smith)"
                       class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition duration-150">
                
                <button id="searchButton" 
                        class="bg-primary hover:bg-secondary text-white font-bold py-3 px-6 rounded-lg transition duration-150 transform hover:scale-[1.01] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed"
                        onclick="startSearch()">
                    Search Courts
                </button>
            </div>
            <p id="apiEndpoint" class="text-xs mt-2 text-gray-400 truncate">
                API Endpoint: <span id="api_url_display"></span>
            </p>
        </div>

        <!-- Status and Loading Area -->
        <div id="statusArea" class="mb-8">
            <!-- Messages will be injected here -->
        </div>

        <!-- Results Display Area -->
        <div id="resultsContainer" class="space-y-6">
            <!-- County result cards will be injected here -->
        </div>

    </div>

    <script>
        // API Endpoint for the Render service. This is the URL you confirmed is live.
        // It MUST end with a slash if the endpoint is not directly in the root path.
        const API_BASE_URL = 'https://sc-court-scraper-live.onrender.com';
        const SEARCH_ENDPOINT = '/api/scan';

        document.getElementById('api_url_display').textContent = API_BASE_URL + SEARCH_ENDPOINT;

        const nameInput = document.getElementById('nameInput');
        const searchButton = document.getElementById('searchButton');
        const statusArea = document.getElementById('statusArea');
        const resultsContainer = document.getElementById('resultsContainer');

        /**
         * Utility function to show dynamic status messages
         * @param {string} message 
         * @param {string} type - 'info', 'error', or 'loading'
         */
        function showStatus(message, type = 'info') {
            let color, iconHtml = '';
            
            switch (type) {
                case 'error':
                    color = 'bg-red-100 text-red-800';
                    iconHtml = `<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`;
                    break;
                case 'loading':
                    color = 'bg-blue-100 text-blue-800';
                    iconHtml = `
                        <div class="flex space-x-1 mr-2">
                            <span class="loading-dot w-2 h-2 bg-blue-600 rounded-full"></span>
                            <span class="loading-dot w-2 h-2 bg-blue-600 rounded-full"></span>
                            <span class="loading-dot w-2 h-2 bg-blue-600 rounded-full"></span>
                        </div>`;
                    break;
                case 'info':
                default:
                    color = 'bg-yellow-100 text-yellow-800';
                    iconHtml = `<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`;
                    break;
            }

            statusArea.innerHTML = `
                <div class="p-4 rounded-lg flex items-center ${color} font-medium">
                    ${iconHtml}
                    <span>${message}</span>
                </div>
            `;
        }

        /**
         * Creates an HTML card for a single county's results.
         * @param {string} countyName 
         * @param {Array} results 
         */
        function createCountyCard(countyName, results) {
            let contentHtml = '';

            if (results.length === 0) {
                contentHtml = '<p class="text-gray-500 italic p-4">No results found for this name.</p>';
            } else {
                contentHtml = `
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Case Number</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Party</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${results.map(item => `
                                    <tr class="hover:bg-indigo-50 transition duration-150">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-primary hover:underline cursor-pointer" onclick="window.open('${item.url}', '_blank')">${item.caseNumber}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.date}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.party}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.type}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${item.status.includes('Active') ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                                ${item.status}
                                            </span>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            const card = document.createElement('div');
            card.className = 'bg-white rounded-xl container-card overflow-hidden';
            card.innerHTML = `
                <div class="p-4 sm:p-6 bg-primary text-white flex justify-between items-center">
                    <h3 class="text-2xl font-bold">${countyName} County</h3>
                    <span class="text-sm font-semibold">${results.length} Result(s)</span>
                </div>
                ${contentHtml}
            `;
            resultsContainer.appendChild(card);
        }

        async function startSearch() {
            const searchName = nameInput.value.trim();

            if (!searchName) {
                showStatus('Please enter a name to search.', 'info');
                return;
            }

            // UI feedback
            resultsContainer.innerHTML = ''; // Clear old results
            searchButton.disabled = true;
            showStatus(`Searching for "${searchName}" across all counties...`, 'loading');

            const fullUrl = `${API_BASE_URL}${SEARCH_ENDPOINT}?name=${encodeURIComponent(searchName)}`;

            try {
                const response = await fetch(fullUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`API returned status ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                // Check for API errors within the JSON response
                if (data.error) {
                    throw new Error(data.error);
                }

                // Process and display results
                let totalResults = 0;
                
                // Get the list of counties in a defined order for consistent display
                const countyOrder = ['Clarendon', 'Lee', 'Sumter', 'Williamsburg'];
                
                countyOrder.forEach(county => {
                    if (data[county]) {
                        createCountyCard(county, data[county]);
                        totalResults += data[county].length;
                    }
                });

                showStatus(`Search Complete! Found ${totalResults} total case records for "${searchName}".`, 'info');

            } catch (error) {
                console.error("Search failed:", error);
                showStatus(`Search failed due to an API error. Check the console for details. Error: ${error.message}`, 'error');
            } finally {
                searchButton.disabled = false;
            }
        }

        // Initial setup on load
        window.onload = () => {
            showStatus('Enter a name and click Search to begin scraping data.', 'info');
        }
    </script>
</body>
</html>


